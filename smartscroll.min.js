(function($){var MOUSE_EVENTS_STRING="mousewheel DOMMouseScroll wheel MozMousePixelScroll";var lethargy;if(typeof Lethargy!=="undefined"&&Lethargy!==null){lethargy=new Lethargy}var getWindowTop=function(){return Math.max(window.pageYOffset,window.document.body.scrollTop,window.document.documentElement.scrollTop)};$.smartscroll=function smartscroll(overrides){var options=$.extend({},$.smartscroll.defaults,overrides);if(!options.sectionSelector){options.sectionSelector="."+options.sectionClass}if(typeof EventEmitter==="undefined"||EventEmitter===null||options.eventEmitter&&options.eventEmitter.constructor!==EventEmitter){options.eventEmitter=null}if(options.bindSwipe){var xDown=null;var yDown=null;var handleTouchStart=function(event){var e=event.originalEvent||event;xDown=e.touches[0].clientX;yDown=e.touches[0].clientY};var handleTouchMove=function(event){var e=event.originalEvent||event;if(!xDown||!yDown){return}var xUp=e.touches[0].clientX;var yUp=e.touches[0].clientY;var xDiff=xDown-xUp;var yDiff=yDown-yUp;if(Math.abs(xDiff)>Math.abs(yDiff)){if(xDiff>0){options.eventEmitter.emitEvent("swipeLeft")}else{options.eventEmitter.emitEvent("swipeRight")}}else if(yDiff>0){options.eventEmitter.emitEvent("swipeUp")}else{options.eventEmitter.emitEvent("swipeDown")}xDown=null;yDown=null}}var isScrolling=false;var sections=[];var sectionWrapperTop;var sectionWrapperBottom;var validBreakPoint=false;var belowBreakpoint=false;var currentHash=window.location.hash;var sectionWrapper=$(options.sectionWrapperSelector+":first");var sectionWrapperIsVisible=function(){var windowTop=getWindowTop();var windowBottom=windowTop+$(window).height();if(windowBottom>sectionWrapperTop&&windowTop<=sectionWrapperBottom){return true}return false};var calculateSectionBottoms=function(){var tmpSections=[];sectionWrapperTop=Math.round(sectionWrapper.position().top+parseInt(sectionWrapper.css("paddingTop"),10)+parseInt(sectionWrapper.css("borderTopWidth"),10)+parseInt(sectionWrapper.css("marginTop"),10));sectionWrapperBottom=Math.round(sectionWrapperTop+sectionWrapper.height(),10);tmpSections.push(sectionWrapperTop);$(options.sectionSelector).each(function(i,el){tmpSections.push(Math.round(sectionWrapperTop+$(el).position().top+$(el).outerHeight()))});sections=tmpSections};var getScrollAction=function(e){var validScroll;if(lethargy){validScroll=lethargy.check(e)}if(!isScrolling){if(lethargy){if(validScroll===1){return"up"}else if(validScroll===-1){return"down"}}else if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){return"up"}else if(e.originalEvent.wheelDelta<0||e.originalEvent.detail>0){return"down"}}return false};var getSectionIndexAt=function(position){for(var i=0;i<sections.length;i+=1){if(position<=sections[i]){return i}}return sections.length};var autoHash=function(){var newHash;if(getWindowTop()+$(window).height()/2<sectionWrapperTop){newHash=options.headerHash}else{var slideIndex=getSectionIndexAt(getWindowTop()+$(window).height()/2);if(slideIndex!==undefined){newHash=$(options.sectionSelector+":nth-of-type("+(slideIndex+1)+")").data("hash")}}if(typeof newHash==="undefined"||!(window.location.hash==="#"+newHash)){if(typeof newHash==="undefined"){newHash=options.headerHash}if(!options.keepHistory){window.location.replace(window.location.href.split("#")[0]+"#"+newHash)}else{window.location.hash=newHash}}};var scrollToPixel=function(pixel,speed){if(isScrolling){return}isScrolling=true;$("body,html").stop(true,true).animate({scrollTop:pixel},speed,function(){isScrolling=false;if(options.eventEmitter){options.eventEmitter.emitEvent("scrollEnd")}})};this.scroll=function scroll(down){if(sections){var windowTop=getWindowTop();if(options.eventEmitter){var sectionIndexAtWindowMiddle=getSectionIndexAt(windowTop+$(window).height()/2);var nextSlideNumber=down?sectionIndexAtWindowMiddle+1:sectionIndexAtWindowMiddle-1;options.eventEmitter.emitEvent("scrollStart",[nextSlideNumber])}for(var i=0;i<sections.length;i+=1){if(windowTop<sections[i]){if(down){scrollToPixel(sections[i],700)}else{scrollToPixel(sections[i-1]-$(window).height(),700)}if(options.eventEmitter){options.eventEmitter.emitEvent("scrollEnd")}return false}}}return undefined};var bindScroll=function(){$(window).bind(MOUSE_EVENTS_STRING,function(e){var scrollAction=getScrollAction(e);if(options.dynamicHeight){calculateSectionBottoms()}var windowTop=getWindowTop();var windowBottom=windowTop+$(window).height();if(windowBottom>sectionWrapperTop&&windowTop<=sectionWrapperBottom){var sectionIndexAtWindowTop=getSectionIndexAt(windowTop);var sectionIndexAtWindowMiddle=getSectionIndexAt(windowTop+$(window).height()/2);var sectionIndexAtWindowBottom=getSectionIndexAt(windowBottom);if(sectionIndexAtWindowTop!==sectionIndexAtWindowBottom||!options.innerSectionScroll){e.preventDefault();e.stopPropagation();if(scrollAction){if(scrollAction==="up"){if(options.toptotop){scrollToPixel(sections[sectionIndexAtWindowMiddle-2]+1,options.animationSpeed)}else{scrollToPixel(sections[sectionIndexAtWindowMiddle-1]-$(window).height(),options.animationSpeed)}if(options.eventEmitter){options.eventEmitter.emitEvent("scrollStart",[sectionIndexAtWindowMiddle-1])}}else if(scrollAction==="down"){scrollToPixel(sections[sectionIndexAtWindowMiddle]+1,options.animationSpeed);if(options.eventEmitter){options.eventEmitter.emitEvent("scrollStart",[sectionIndexAtWindowMiddle+1])}}}}}})};var unbindScroll=function(){$(window).unbind(MOUSE_EVENTS_STRING)};sectionWrapper.css({position:"relative"});setTimeout(function(){calculateSectionBottoms();if(options.autoHash){if(options.eventEmitter!==null&&!options.hashContinuousUpdate){options.eventEmitter.addListener("scrollEnd",autoHash)}else{$(window).bind("scroll",autoHash)}}if(options.initialScroll&&currentHash.length>0){var matchedObject=$('[data-hash="'+currentHash.substr(1)+'"]');if(matchedObject.length>0){scrollToPixel(matchedObject[0].offsetTop+sectionWrapperTop,0)}}},50);$(window).bind("resize",calculateSectionBottoms);if(options.breakpoint!==null&&options.breakpoint===parseInt(options.breakpoint,10)&&options.breakpoint>0){validBreakPoint=true}if(options.mode==="vp"){if(options.ie8){var resizeToVP=function(){$(options.sectionSelector).css({height:$(window).height()})};resizeToVP();$(window).bind("resize",resizeToVP)}else{$(options.sectionSelector).css({height:"100vh"})}}if(options.sectionScroll){if(validBreakPoint){$(window).bind("resize",function(){if($(window).width()<options.breakpoint){if(!belowBreakpoint){unbindScroll();belowBreakpoint=true;return false}}else if(belowBreakpoint){bindScroll();belowBreakpoint=false}return undefined})}bindScroll()}if(options.bindSwipe){$(window).on("touchstart",handleTouchStart);$(window).on("touchmove",handleTouchMove)}if(options.bindKeyboard){var handleKeydown=function(event){var e=event.originalEvent||event;if(options.dynamicHeight){calculateSectionBottoms()}var windowTop=getWindowTop();var windowBottom=windowTop+$(window).height();if(sectionWrapperIsVisible()){var sectionIndexAtWindowTop=getSectionIndexAt(windowTop);var sectionIndexAtWindowMiddle=getSectionIndexAt(windowTop+$(window).height()/2);var sectionIndexAtWindowBottom=getSectionIndexAt(windowBottom);if(sectionIndexAtWindowTop!==sectionIndexAtWindowBottom||!options.innerSectionScroll){switch(e.which){case 38:e.preventDefault();e.stopPropagation();if(options.toptotop){scrollToPixel(sections[sectionIndexAtWindowMiddle-2]+1,options.animationSpeed)}else{scrollToPixel(sections[sectionIndexAtWindowMiddle-1]-$(window).height(),options.animationSpeed)}if(options.eventEmitter){options.eventEmitter.emitEvent("scrollStart",[sectionIndexAtWindowMiddle-1])}break;case 40:e.preventDefault();e.stopPropagation();scrollToPixel(sections[sectionIndexAtWindowMiddle]+1,options.animationSpeed);if(options.eventEmitter){options.eventEmitter.emitEvent("scrollStart",[sectionIndexAtWindowMiddle+1])}break;default:}}}};$(window).on("keydown",handleKeydown)}return this};$.smartscroll.defaults={animationSpeed:700,autoHash:true,breakpoint:null,initialScroll:true,headerHash:"header",keepHistory:false,mode:"vp",sectionClass:"section",sectionSelector:null,sectionScroll:true,sectionWrapperSelector:".section-wrapper",eventEmitter:null,dynamicHeight:false,ie8:false,hashContinuousUpdate:true,innerSectionScroll:true,toptotop:false,bindSwipe:true,bindKeyboard:true}})(jQuery);